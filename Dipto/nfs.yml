---
- hosts: all
  vars:
    nfs_mountpoint: "/mnt/nfs"
    nfs_server: "192.168.43.254"
    nfsexport:  "/mnt/nfs"
  tasks:
     - name: Check and Install nfs packages
       package: 
        name: nfs-utils
        state: present
       with_items:
        - nfs-utils
       tags: nfs_client,nfs_server
     - name: copy files
       template: 
        src: /root/Desktop/Github/Menu-Automation/nfs
        dest: /etc/exports
        mode: 755
       tags: nfs_server
     - name: start nfs server
       service: 
         name: nfs
         state: restarted 
         enabled: yes
       tags: nfs_server
     - name: create mountpoint
       file: 
         path: "{{nfs_mountpoint}}"
         state: directory
       tags: nfs_client
     - name: Update Fstab
       mount:
         name: "{{nfs_mountpoint}}"
         src: "{{nfs_server }}:/{{nfsexport}}"
         fstype: nfs
         state: mounted
       tags: nfs_client
